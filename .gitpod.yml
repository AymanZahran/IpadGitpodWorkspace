image: aymanzahran/ipad-gitpod-image
  #file: .gitpod.Dockerfile
tasks:
  - name: persist env
    command: eval $(gp env -e)
  - name: Configure AWS Profile
    command: |
      echo "[gitpod]" > ~/.aws/config
      echo "region = $AWS_DEFAULT_REGION" >> ~/.aws/config
      echo "cli_auto_prompt = on-partial" >> ~/.aws/config
      echo "[gitpod]" > ~/.aws/credentials
      echo "aws_access_key_id = $AWS_ACCESS_KEY_ID" >> ~/.aws/credentials
      echo "aws_secret_access_key = $AWS_SECRET_ACCESS_KEY" >> ~/.aws/credentials
  # - name: Launch Okteto
  #   command: |
  #     okteto context use https://cloud.okteto.com
  #     okteto deploy
  #     kubectl port-forward service/jenkins-master 8001:80
  - name: Configure K8s
    command: echo $K8S_CONFIG | base64 --decode > ~/.kube/config
  - name: Launch Jenkins
    command: |
      kubectl apply -f Kubernetes/jenkins-master.yaml
      kubectl port-forward service/jenkins-master 8001:80
  - name: Launch Ansible Controller
    command: |
      kubectl apply -f Kubernetes/ansible-controller.yaml
      kubectl port-forward service/ansible-controller 8002:80
  - name: Launch Ansible Target
    command: |
      kubectl apply -f Kubernetes/ansible-target.yaml
      kubectl port-forward service/ansible-target 8003:80

vscode:
  extensions:
    - ms-azuretools.vscode-docker
    - ms-kubernetes-tools.vscode-kubernetes-tools
    - amazonwebservices.aws-toolkit-vscode
    - ms-toolsai.jupyter
    - esbenp.prettier-vscode
    - dbaeumer.vscode-eslint
    - hashicorp.terraform
    - eg2.vscode-npm-script
    - christian-kohler.npm-intellisense
    - christian-kohler.path-intellisense
    - ms-python.python
    - rangav.vscode-thunder-client
    - PKief.material-icon-theme
